# Souffle - A Datalog Compiler
# Copyright (c) 2013, Oracle and/or its affiliates. All rights reserved.
# Licensed under the Universal Permissive License v 1.0 as shown at:
# - https://opensource.org/licenses/UPL
# - <souffle root>/licenses/SOUFFLE-UPL.txt

dnl Execute a positive interface test case
dnl $1 -- test case
dnl $2 -- category
m4_define([TEST_EVAL_FUNCTOR],[
  m4_define([TESTNAME],[$1])
  m4_define([CATEGORY],[$2])
  m4_define([TESTDIR],[$TESTS/CATEGORY/TESTNAME])
  m4_define([PROGRAM],[TESTDIR/TESTNAME.dl])
  m4_define([FACTS],[TESTDIR/facts])
  dnl copy libs from where they were built
  cp ../../evaluation/functors/.libs/libfunctors* .
  # invoke souffle
  AT_CHECK([DYLD_FRAMEWORK_PATH=. LD_LIBRARY_PATH=. "$SOUFFLE" FLAGS -L. -D. -F FACTS PROGRAM 1>TESTNAME.out 2>TESTNAME.err], [0])
  SORTED_SAME_FILES([*.csv],[TESTDIR])
  SAME_FILE([TESTNAME.out],[TESTDIR/TESTNAME.out])
  SAME_FILE([TESTNAME.err],[TESTDIR/TESTNAME.err])
])

dnl Positive interface testcase for Souffle
dnl $1 -- test name
dnl $2 -- category
m4_define([POSITIVE_FUNCTOR_TEST],[
  TEST_GROUP([$1],[
    TEST_EVAL_FUNCTOR([$1],[$2])
  ])
])


dnl Positive test cases for evaluating Datalog programs

POSITIVE_TEST([access1],[evaluation])
POSITIVE_TEST([access2],[evaluation])
POSITIVE_TEST([access3],[evaluation])
POSITIVE_TEST([aggregates],[evaluation])
POSITIVE_TEST([aggregates2],[evaluation])
POSITIVE_TEST([aggregates3],[evaluation])
POSITIVE_TEST([aggregates_complex],[evaluation])
POSITIVE_TEST([aliases],[evaluation])
POSITIVE_TEST([arithm],[evaluation])
POSITIVE_TEST([average],[evaluation])
POSITIVE_TEST([binop],[evaluation])
POSITIVE_TEST([cat],[evaluation])
POSITIVE_TEST([comp-override1],[evaluation])
POSITIVE_TEST([comp-override2],[evaluation])
POSITIVE_TEST([comp-override3],[evaluation])
POSITIVE_TEST([components1],[evaluation])
POSITIVE_TEST([components2],[evaluation])
POSITIVE_TEST([components3],[evaluation])
POSITIVE_TEST([components],[evaluation])
POSITIVE_TEST([components_generic],[evaluation])
POSITIVE_TEST([contains],[evaluation])
POSITIVE_TEST([count],[evaluation])
POSITIVE_TEST([count_sccs1],[evaluation])
POSITIVE_TEST([counter],[evaluation])
POSITIVE_TEST([cprog1],[evaluation])
POSITIVE_TEST([cprog2],[evaluation])
POSITIVE_TEST([cprog3],[evaluation])
POSITIVE_TEST([cprog4],[evaluation])
POSITIVE_TEST([cprog5],[evaluation])
POSITIVE_TEST([cproject],[evaluation])
POSITIVE_TEST([empty_relations],[evaluation])
POSITIVE_TEST([existential],[evaluation])
POSITIVE_TEST([facts],[evaluation])
POSITIVE_TEST([float_operations],[evaluation])
POSITIVE_TEST([functor_arity],[evaluation])
POSITIVE_TEST([grammar],[evaluation])
POSITIVE_TEST([hex],[evaluation])
POSITIVE_TEST([independent_body1],[evaluation])
POSITIVE_TEST([independent_body2],[evaluation])
POSITIVE_TEST([index],[evaluation])
POSITIVE_TEST([indirect_negation],[evaluation])
POSITIVE_TEST([inline_functors],[evaluation])
POSITIVE_TEST([inline_negation1],[evaluation])
POSITIVE_TEST([inline_negation2],[evaluation])
POSITIVE_TEST([inline_nqueens],[evaluation])
POSITIVE_TEST([inline_records],[evaluation])
POSITIVE_TEST([inline_underscore],[evaluation])
POSITIVE_TEST([inline_unification],[evaluation])
POSITIVE_TEST([list],[evaluation])
POSITIVE_TEST([magic_2sat],[evaluation])
POSITIVE_TEST([magic_aggregates],[evaluation])
POSITIVE_TEST([magic_centroids],[evaluation])
POSITIVE_TEST([magic_circuit_sat],[evaluation])
POSITIVE_TEST([magic_components],[evaluation])
POSITIVE_TEST([magic_cprog1],[evaluation])
POSITIVE_TEST([magic_dfa],[evaluation])
POSITIVE_TEST([magic_dominance],[evaluation])
POSITIVE_TEST([magic_factoring],[evaluation])
POSITIVE_TEST([magic_goal],[evaluation])
POSITIVE_TEST([magic_lrg_attr_id],[evaluation])
POSITIVE_TEST([magic_movies],[evaluation])
POSITIVE_TEST([magic_names1],[evaluation])
POSITIVE_TEST([magic_nqueens],[evaluation])
POSITIVE_TEST([magic_perfect_numbers],[evaluation])
POSITIVE_TEST([magic_records4],[evaluation])
POSITIVE_TEST([magic_samegen],[evaluation])
POSITIVE_TEST([magic_strategies],[evaluation])
POSITIVE_TEST([magic_string_substr],[evaluation])
POSITIVE_TEST([magic_turing1],[evaluation])
POSITIVE_TEST([match2],[evaluation])
POSITIVE_TEST([match3],[evaluation])
POSITIVE_TEST([match],[evaluation])
# TODO (see issue #298) POSITIVE_TEST([math], [evaluation])
POSITIVE_TEST([max],[evaluation])
POSITIVE_TEST([minmax],[evaluation])
POSITIVE_TEST([minmaxnum], [evaluation])
POSITIVE_TEST([mrtc],[evaluation])
POSITIVE_TEST([mul],[evaluation])
POSITIVE_TEST([multiple_heads],[evaluation])
POSITIVE_TEST([mutrecursion],[evaluation])
POSITIVE_TEST([neg1],[evaluation])
POSITIVE_TEST([neg2],[evaluation])
POSITIVE_TEST([neg3],[evaluation])
POSITIVE_TEST([neg4],[evaluation])
POSITIVE_TEST([neg5],[evaluation])
POSITIVE_TEST([neg6],[evaluation])
POSITIVE_TEST([number_constants],[evaluation])
POSITIVE_TEST([numeric_binary_constraint_op], [evaluation])
POSITIVE_TEST([numeric_conversions],[evaluation])
POSITIVE_TEST([ordinals],[evaluation])
POSITIVE_TEST([plus],[evaluation])
POSITIVE_TEST([range],[evaluation])
POSITIVE_TEST([rec_lists2],[evaluation])
POSITIVE_TEST([rec_lists],[evaluation])
POSITIVE_TEST([recursion],[evaluation])
POSITIVE_TEST([relop],[evaluation])
POSITIVE_TEST([rmut2],[evaluation])
POSITIVE_TEST([rmut],[evaluation])
POSITIVE_TEST([set_ops],[evaluation])
POSITIVE_TEST([set_ops_output],[evaluation])
POSITIVE_TEST([simple],[evaluation])
POSITIVE_TEST([singleton],[evaluation])
POSITIVE_TEST([subsumption],[evaluation])
POSITIVE_TEST([subtype2],[evaluation])
POSITIVE_TEST([subtype],[evaluation])
POSITIVE_TEST([sum-aggregate],[evaluation])
POSITIVE_TEST([sum-aggregate2],[evaluation])
POSITIVE_TEST([term],[evaluation])
POSITIVE_TEST([unpacking],[evaluation])
POSITIVE_TEST([unsigned_operations], [evaluation])
POSITIVE_TEST([unused_constraints],[evaluation])
POSITIVE_TEST([x9],[evaluation])


POSITIVE_FUNCTOR_TEST([functors],[evaluation])
